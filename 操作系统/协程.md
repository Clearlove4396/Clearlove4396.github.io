> 什么是**协程**？

- 一句话解释：**单线程执行多任务**。协程本质上是**一个可以“暂停”的函数，它可以做到外观上和一个正常函数没有区别，写起来更自然；通过保存调用栈的方式，让它在暂停之后可以干点别的**。
- 协程是线程的更小切分，又称为“微线程”，是一种**用户态**的轻量级线程。
- 线程是系统级别的，它们由操作系统调度；协会则是**程序级别**的，由**程序员根据需要自己调度**。

- 在一个线程中会有很多函数，我们把这些函数称为子程序，在子程序执行过程中可以中断去执行别的子程序，而别的子程序也可以中断回来继续执行之前的子程序，这个过程就称为协程。也就是说**在同一线程内一段代码在执行过程中会中断然后跳转执行别的代码，接着在之前中断的地方继续开始执行**。



> 与进程的异同？

1. 相同点
   - 当我们挂起一个执行流时，我们要保存的东西：
     - 栈
     - 寄存器状态
2. 不同点
   - 执行流的调度不同，**进程是由内核调度的，而协程是用户态调度**，也就是说进程的上下文是在内核态保护恢复的，而协程是在用户态保存恢复的。
   - 进程会被强占，而协程不会，协程如果不主动让出CPU，那么其他的协程就没有执行的机会。
   - 对内存的占用大小不同



> 协程的优点

- 无需线程上下文切换的开销，协程避免了无意义的调度，由此可以提高性能。（执行效率恨到，因为子程序切换不是线程切换，由程序自身控制，没有切换线程的开销。
- 无需原子操作锁定及同步的开销
- 方便切换控制流，简化编程模型
- 高并发+高可扩+低成本



> 协程的缺点

- 无法利用多核资源

- 进行阻塞操作会阻塞掉整个程序。（当线程在用户态实现时）




https://b23.tv/czYerh

![image-20200914194740791](.\pictures\协程.png)